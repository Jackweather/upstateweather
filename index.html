<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Model Viewer</title>
    <style>
        /* General Styles */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f5f7fa;
            color: #333;
        }

        header {
            background-color: #4CAF50;
            color: white;
            text-align: center;
            padding: 15px 0;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        main {
            display: flex;
            flex-direction: row;
            height: calc(100vh - 60px); /* Full height minus header */
        }

        /* Sidebar for Computers */
        #sidebar {
            width: 250px;
            background-color: #333;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
        }

        #sidebar select {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        #sidebar select:hover {
            background-color: #45a049;
        }

        #sidebar select:active {
            background-color: #3e8e41;
        }

        /* Main Content */
        #main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .image-container {
            width: 100%;
            max-width: 800px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .image-container img {
            max-width: 100%;
            max-height: 70vh;
            border: 2px solid #333;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.2);
        }

        .slider-container {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .slider-container label {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .slider-container input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            main {
                flex-direction: column;
            }

            #sidebar {
                width: 100%;
                height: auto;
                flex-direction: row;
                justify-content: space-around;
                padding: 10px;
                box-shadow: none;
            }

            #main-content {
                padding: 10px;
            }

            .image-container img {
                max-height: 50vh;
            }

            .slider-container input[type="range"] {
                width: 90%;
            }
        }
    </style>
</head>
<body>
    <header>
        Weather Model Viewer
    </header>
    <main>
        <div id="sidebar">
            <label for="regionDropdown" style="color: white; font-size: 16px; font-weight: bold;">Region</label>
            <select id="regionDropdown">
                <option value="" disabled selected>Select Region</option>
                <option value="main">Main</option>
                <option value="northeast">Northeast</option>
                <option value="prate">Northeast - Prate</option>
            </select>
        </div>
        <div id="main-content">
            <div class="image-container">
                <img id="weatherImage" src="https://weather-data21.s3.us-east-2.amazonaws.com/GFS_output/mslp/png/usa_gfs_000.png" alt="Weather Image">
            </div>
            <div class="slider-container">
                <label for="forecastSlider">Forecast Hour: <span id="forecastHour">0</span></label>
                <input id="forecastSlider" type="range" min="0" max="384" step="6" value="0">
            </div>
        </div>
    </main>
    <script>
        const image = document.getElementById('weatherImage');
        const forecastSlider = document.getElementById('forecastSlider');
        const forecastHour = document.getElementById('forecastHour');
        const regionDropdown = document.getElementById('regionDropdown');

        let isPrateMode = false; // Track if "Prate" mode is active

        // Preload a small chunk of images for both "Main" and "Prate" modes
        const preloadImages = (currentValue) => {
            const images = [];
            const minRange = Math.max(0, currentValue - 30); // Start 5 steps before the current value
            const maxRange = Math.min(384, currentValue + 30); // End 5 steps after the current value

            for (let i = minRange; i <= maxRange; i += 6) {
                const step = i.toString().padStart(3, '0');

                // Preload "Main" images
                const mainImg = new Image();
                mainImg.src = `https://weather-data21.s3.us-east-2.amazonaws.com/GFS_output/mslp/png/usa_gfs_${step}.png`;
                images.push(mainImg);

                // Preload "Prate" images
                const prateImg = new Image();
                prateImg.src = `https://weather-data21.s3.us-east-2.amazonaws.com/GFS_output/mslp/northeast/png/northeast_gfs_${step}.png`;
                images.push(prateImg);
            }
        };

        // Update the image source and forecast hour label based on the slider value
        function updateImage() {
            const step = parseInt(forecastSlider.value).toString().padStart(3, '0');
            if (isPrateMode) {
                image.src = `https://weather-data21.s3.us-east-2.amazonaws.com/GFS_output/mslp/northeast/png/northeast_gfs_${step}.png`;
            } else {
                image.src = `https://weather-data21.s3.us-east-2.amazonaws.com/GFS_output/mslp/png/usa_gfs_${step}.png`;
            }
            forecastHour.textContent = step;

            // Preload images around the current slider value
            preloadImages(parseInt(forecastSlider.value));
        }

        // Call preloadImages initially for the default slider value
        preloadImages(parseInt(forecastSlider.value));

        // Event listener for the slider
        forecastSlider.addEventListener('input', updateImage);

        // Handle region selection
        regionDropdown.addEventListener('change', (event) => {
            const selectedRegion = event.target.value;
            console.log(`Selected region: ${selectedRegion}`);

            // Remove the "Prate" option if it exists
            const prateOption = document.querySelector('#regionDropdown option[value="prate"]');
            if (prateOption) {
                prateOption.remove();
            }

            if (selectedRegion === 'main') {
                isPrateMode = false; // Disable "Prate" mode
                image.src = `https://weather-data21.s3.us-east-2.amazonaws.com/GFS_output/mslp/png/usa_gfs_${forecastSlider.value.padStart(3, '0')}.png`;

                // Close the dropdown and set the selected option as the default
                regionDropdown.blur(); // Close the dropdown
            } else if (selectedRegion === 'northeast') {
                isPrateMode = false; // Disable "Prate" mode
                image.src = `https://weather-data21.s3.us-east-2.amazonaws.com/GFS_output/mslp/png/usa_gfs_${forecastSlider.value.padStart(3, '0')}.png`;

                // Add the "Prate" option dynamically
                const prateOption = document.createElement('option');
                prateOption.value = 'prate';
                prateOption.textContent = 'Northeast - Prate';
                regionDropdown.appendChild(prateOption);

                // Keep the dropdown open
                setTimeout(() => {
                    regionDropdown.size = regionDropdown.options.length; // Expand dropdown
                }, 0);
            } else if (selectedRegion === 'prate') {
                isPrateMode = true; // Enable "Prate" mode
                image.src = `https://weather-data21.s3.us-east-2.amazonaws.com/GFS_output/mslp/northeast/png/northeast_gfs_${forecastSlider.value.padStart(3, '0')}.png`;

                // Close the dropdown and set the selected option as the default
                regionDropdown.blur(); // Close the dropdown
            }

            updateImage(); // Update the image
        });

        // Add an event listener to collapse the dropdown when the user clicks outside
        document.addEventListener('click', (event) => {
            if (!regionDropdown.contains(event.target)) {
                regionDropdown.size = 1; // Collapse dropdown
            }
        });

        // Add an event listener to reset dropdown size when it gains focus
        regionDropdown.addEventListener('focus', () => {
            regionDropdown.size = 1; // Ensure dropdown starts collapsed
        });

        // Add event listener for keydown events
        document.addEventListener('keydown', (event) => {
            if (event.key === 'ArrowRight') {
                // Move slider to the right (increase value)
                if (forecastSlider.value < forecastSlider.max) {
                    forecastSlider.value = parseInt(forecastSlider.value) + parseInt(forecastSlider.step);
                    updateImage(); // Update the image
                }
            } else if (event.key === 'ArrowLeft') {
                // Move slider to the left (decrease value)
                if (forecastSlider.value > forecastSlider.min) {
                    forecastSlider.value = parseInt(forecastSlider.value) - parseInt(forecastSlider.step);
                    updateImage(); // Update the image
                }
            }
        });
    </script>
</body>
</html>
